<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Webcam</title>
</head>
<body>
    <h2 style="text-align: center;">Live Webcam Feed</h2>
    <div style="text-align: center;">
        <!-- Live video stream from Flask -->
        <img id="livefeed" src="{{ url_for('video_feed') }}" width="640" height="480" style="border: 2px solid black;">
        
        <br><br>

        <!-- Capture Button (handled via JS) -->
        <button id="captureBtn" style="padding: 10px 20px; font-size: 16px;">Capture Image</button>

        <br><br>
        <div id="result"></div>

        <!-- Back to main page -->
        <a href="/" style="display: inline-block; margin-top: 20px;">Back to Home</a>
    </div>

    <script>
      document.getElementById('livefeed').onerror = function () {
        console.error("Failed to load webcam feed from /video_feed");
        alert("Unable to load webcam feed. Make sure your webcam is connected and not being used by another app.");
      };

      document.getElementById('captureBtn').onclick = function () {
        fetch('/capture', { method: 'POST' })
          .then(res => res.json())
          .then(data => {
            if (data.error) {
              alert("Error: " + data.message);
            } else {
              const output = document.getElementById('result');
              output.innerHTML = `
                <p><strong>Output:</strong> ${data.digest}</p>
                <img src="/procimage/${data.img_id}" width="320" style="margin-top: 10px; border: 1px solid black;">
              `;
            }
          })
          .catch(err => alert("Failed to capture image: " + err));
      };
    </script>
</body>
</html>
